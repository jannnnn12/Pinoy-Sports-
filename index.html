<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Typing Test Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-image: url("img/spiral.gif");
    background-size: cover;
   
    background-repeat: no-repeat;
    padding: 20px;
    margin: 0;
    text-align: center;
  }

  .box {
    max-width: 700px;
   
    margin: auto;
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
  }

  .layout {
    display: none;
  }
  .active {
    display: block;
  }

  .word-list, .test-words {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-bottom: 20px;
  }

  .word-list span {
    padding: 5px 8px;
    background: #e0e0ff;
    border-radius: 5px;
    cursor: pointer;
  }

  input[type="text"] {
    padding: 8px;
    width: 250px;
    margin-right: 5px;
  }

  button {
    padding: 8px 12px;
    margin: 5px;
    cursor: pointer;
  }

  .test-words span {
    padding: 5px 8px;
    border-radius: 5px;
    background-color: #f5f5f5;
    color: rgb(49, 39, 20);
  }

  .current {
    background-color: lightblue;
  }

  .correct {
    background-color: lightgreen !important;
  }

  .incorrect {
    background-color: #ffcccc !important;
  }

  .stats {
    margin-top: 15px;
    font-size: 18px;
    color: red;
  }

  /* New: Sticky input bar and scrollable word list */
  .test-container {
    max-height: 300px; 
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  .input-wrapper {
    position: sticky;
    top: 0;
    background: white;
    padding: 10px 0;
    z-index: 5;
    border-bottom: 2px solid #eee;
  }
</style>
</head>
<body>
<div class="box">

  <!-- Layout 1: Setup -->
  <div id="layout1" class="layout active">
    <h2>üìù Word List Setup</h2>
    <p>Click a word to remove it</p>
    <div class="word-list" id="wordList"></div>
    <input type="text" id="newWordInput" placeholder="Add a word">
    <button onclick="addWord()">Add Word</button>
    <button onclick="startTest()">Start Test</button>
  </div>

  <!-- Layout 2: Typing Test -->
  <div id="layout2" class="layout">
    
    <h2>‚å®Ô∏è Typing Test ( You Got Only 30 Seconds)</h2>
    
    <div class="input-wrapper">
      <input type="text" id="typedInput" placeholder="Type here" autofocus>
    </div>

    <div class="test-container">
      <div class="test-words" id="testWords"></div>
    </div>

    <div class="stats">
      <span id="wpm">WPM: 0</span> |
      <span id="accuracy">Accuracy: 100%</span> |
      <span id="timer">Time: 30s</span>
    </div>
  </div>

  <!-- Layout 3: Results -->
  <div id="layout3" class="layout">
    <h2>üèÜ Results</h2>
    <p id="finalStats"></p>
    <button onclick="resetGame()">Play Again</button>
  </div>

</div>

<script>
let words = ["my", "name", "is", "john"];
let testWords = [];
let currentIndex = 0;
let correctCount = 0;
let totalTyped = 0;
let timeLeft = 30;
let timerInterval;

// Render word list in setup
function renderWordList() {
  const list = document.getElementById("wordList");
  list.innerHTML = "";
  words.forEach((word, index) => {
    const span = document.createElement("span");
    span.textContent = word;
    span.title = "Click to remove";
    span.onclick = () => {
      words.splice(index, 1);
      renderWordList();
    };
    list.appendChild(span);
  });
}

// Add new word
function addWord() {
  const input = document.getElementById("newWordInput");
  const word = input.value.trim().toLowerCase();
  if (word && !words.includes(word)) {
    words.push(word);
    renderWordList();
  }
  input.value = "";
}

// Start typing test
function startTest() {
  if (words.length < 3) {
    alert("Add at least 3 words to start!");
    return;
  }
  // Prepare test words
  testWords = [];
  for (let i = 0; i < 200; i++) {
    testWords.push(words[Math.floor(Math.random() * words.length)]);
  }
  currentIndex = 0;
  correctCount = 0;
  totalTyped = 0;
  timeLeft = 30;

  // Render test words
  const container = document.getElementById("testWords");
  container.innerHTML = "";
  testWords.forEach((w, i) => {
    const span = document.createElement("span");
    span.textContent = w;
    if (i === 0) span.classList.add("current");
    container.appendChild(span);
  });

  // Switch to layout 2
  document.getElementById("layout1").classList.remove("active");
  document.getElementById("layout2").classList.add("active");

  const input = document.getElementById("typedInput");
  input.value = "";
  input.focus();
  input.oninput = handleTyping;

  // Start timer
  document.getElementById("timer").textContent = `Time: ${timeLeft}s`;
  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = `Time: ${timeLeft}s`;
    updateStats();
    if (timeLeft <= 0) {
      endTest();
    }
  }, 1000);
}

// Handle typing logic
function handleTyping(e) {
  const input = document.getElementById("typedInput");
  const value = input.value.trim();

  if (e.inputType === "insertText" && input.value.endsWith(" ")) {
    checkWord(value);
    input.value = "";
  }
}

// Check typed word
function checkWord(word) {
  totalTyped++;
  const wordSpans = document.querySelectorAll("#testWords span");
  const currentSpan = wordSpans[currentIndex];

  if (word === testWords[currentIndex]) {
    currentSpan.classList.add("correct");
    correctCount++;
  } else {
    currentSpan.classList.add("incorrect");
  }
  currentSpan.classList.remove("current");

  currentIndex++;
  if (currentIndex < testWords.length) {
    wordSpans[currentIndex].classList.add("current");
    // Auto-scroll to keep current word in view
    wordSpans[currentIndex].scrollIntoView({ behavior: "smooth", block: "center" });
  }
}

// Update WPM, accuracy
function updateStats() {
  const elapsed = 30 - timeLeft;
  const wpm = elapsed > 0 ? Math.round((correctCount / elapsed) * 60) : 0;
  const accuracy = totalTyped > 0 ? Math.round((correctCount / totalTyped) * 100) : 100;
  document.getElementById("wpm").textContent = `WPM: ${wpm}`;
  document.getElementById("accuracy").textContent = `Accuracy: ${accuracy}%`;
}

// End test
function endTest() {
  clearInterval(timerInterval);
  updateStats();
  const wpmText = document.getElementById("wpm").textContent;
  const accText = document.getElementById("accuracy").textContent;
  document.getElementById("finalStats").innerHTML =
    `${wpmText}<br>${accText}`;
  document.getElementById("layout2").classList.remove("active");
  document.getElementById("layout3").classList.add("active");
}

// Reset game
function resetGame() {
  document.getElementById("layout3").classList.remove("active");
  document.getElementById("layout1").classList.add("active");
  renderWordList();
}

// Initial render
renderWordList();
</script>
</body>
</html>
